http://8btc.com/article-2010-1.html

什么是 Merkle Tree？

发布者: 无主之地 发表于: 2015-11-9 19:10 9750 2 分享
 一、什么是 Merkle Tree？
Merkle Tree，是一种树（数据结构中所说的树），网上大都称为Merkle Hash Tree,这是因为 它所构造的Merkle Tree的所有节点都是Hash值。Merkle Tree具有以下特点：
 1. 它是一种树，可以是二叉树，也可以多叉树，无论是几叉树，它都具有树结构的所有特点；
 2. Merkle树的叶子节点上的value，是由你指定的，这主要看你的设计了，如Merkle Hash Tree会将数据的Hash值作为叶子节点的值；
 3. 非叶子节点的value是根据它下面所有的叶子节点值，然后按照一定的算法计算而得出的。如Merkle Hash Tree的非叶子节点value的计算方法是将该节点的所有子节点进行组合，然后对组合结果进行hash计算所得出的hash value。
例如，下图就是一个Merkle Hash Tree形状，如果它是Merkle Hash Tree，则节点7的hash value必须是通过节点15、16上的value计算而得到.
![190532qh435jd157m3h474](/assets/190532qh435jd157m3h474.png)

二、 Merkle Tree的应用
目前， 在计算机领域，Merkle Tree大多用来进行比对以及验证处理。比特币钱包服务用 Merkle Tree 的机制来作[百分百准备金证明](http://blog.bifubao.com/2014/03/16/proof-of-reserves/) 。在处理比对或验证的应用场景中时，特别是在分布式环境下进行比对或验证时，Merkle Tree会大大减少数据的传输量以及计算的复杂度。例如，就拿图一举例，假如是 15,16.......30是一个个数据块的hash值，我把这些数据从A传输到B，数据传输到B后，我想验证下传输到B上的数据的有效性型（验证数据是否在传输过程中发生变化），只需要验证A 和 B上所构造的Merkle
 Tree的root节点值是否一致即可，如果一致，表示数据是有效的，传输过程中没有发生改变。假如在传输过程中，15对应的数据被人篡改，通过Merkle Tree很容易定位找到（因为此时，节点0,1,3,7,15对应的hash值都发生了变化），定位的时间复杂度为O（log(n））
三、Merkle Tree的优点
相对于 Hash List，Merkle Tree 的明显的一个好处是可以单独拿出一个分支来（作为一个小树）对部分数据进行校验，这个很多使用场合就带来了哈希列表所不能比拟的方便和高效。

----------

http://yishanhe.net/blog/merkle-hash-tree

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 __reader_view_article_wrap_2560192071676195__">
			<article>
    <blockquote>
  <p>本文记录一下自己对Merkle Hash Tree的一些学习. 有人称做 Merkle Tree, 也有人干脆就叫 Hash Tree[1].  因为这货是一个叫做Ralph Merkle在1979年创造的, 才有这个名字的. 据说最早Merkle创造Merkle Tree(MT)的目的是为了生成Lamport签名[2], 一种一次性的数字签名.</p>
</blockquote>

<ul id="markdown-toc">
  <li><a href="#merkle-hash-tree-简介" id="markdown-toc-merkle-hash-tree-简介">Merkle Hash Tree 简介</a></li>
  <li><a href="#应用举例" id="markdown-toc-应用举例">应用举例</a></li>
  <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
  <li><a href="#后记" id="markdown-toc-后记">后记</a></li>
</ul>

<h3 id="merkle-hash-tree-简介">Merkle Hash Tree 简介</h3>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Hash_Tree.svg/300px-Hash_Tree.svg.png" alt="A binary hash tree"></p>

<p>上图(来自Wikipedia[1])给出了一个二进制的哈希树(二叉哈希树, 较常用的tiger hash tree也是这个形式).        据称哈希树经常应用在一些分布式系统或者分布式存储中的反熵机制(Anti-entropy),也有称做去熵的.这些应用包括 Amazon的Dynamo 还有Apache的Cassandra数据库, 通过去熵可以去做到各个不同节点的同步, 即保持各个节点的信息都是同步最新.</p>

<p>哈希树的特点很鲜明: 叶子节点存储的是数据文件，而非叶子节点存储的是其子节点的哈希值(称为MessageDigest)
这些非叶子节点的Hash被称作路径哈希值, 叶子节点的Hash值是真实数据的Hash值.
因为使用了树形结构, MT的时间复杂度为 <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>log</mi><mo>&amp;#x2061;</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 4.483em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.586em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1003.5em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-6"></span><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Math-italic; padding-left: 0.181em;">n</span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">O(\log n)</script></p>

<p>比如下图中, 我们如果使用SHA1算法来做校验值, 比如数据块8对应的哈希值是<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>H</mi><mn>23</mn></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-9" style="width: 2.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.884em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.526em 1001.84em 2.466em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-10"><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-12" style="font-family: MathJax_Main;">23</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><mn>23</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">H23</script>, 则按照这个路径来看
应该有</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>H</mi><mn>11</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy=&quot;false&quot;>(</mo><mi>H</mi><mn>23</mn><mo>&amp;#x2225;</mo><mi>H</mi><mn>24</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-13" style="width: 14.294em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.517em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1011.43em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-14"><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-16" style="font-family: MathJax_Main;">11</span><span class="mo" id="MathJax-Span-17" style="font-family: MathJax_Main; padding-left: 0.271em;">=</span><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math-italic;">A</span><span class="mn" id="MathJax-Span-21" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-22" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-24" style="font-family: MathJax_Main;">23</span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main; padding-left: 0.271em;">∥</span><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-27" style="font-family: MathJax_Main;">24</span><span class="mo" id="MathJax-Span-28" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>H</mi><mn>11</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy="false">(</mo><mi>H</mi><mn>23</mn><mo>∥</mo><mi>H</mi><mn>24</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-3">H11 = SHA1(H23 \parallel H24)</script>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>H</mi><mn>5</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy=&quot;false&quot;>(</mo><mi>H</mi><mn>11</mn><mo>&amp;#x2225;</mo><mi>H</mi><mn>12</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-29" style="width: 13.667em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.024em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1010.93em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-30"><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-32" style="font-family: MathJax_Main;">5</span><span class="mo" id="MathJax-Span-33" style="font-family: MathJax_Main; padding-left: 0.271em;">=</span><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-36" style="font-family: MathJax_Math-italic;">A</span><span class="mn" id="MathJax-Span-37" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-38" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-40" style="font-family: MathJax_Main;">11</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.271em;">∥</span><span class="mi" id="MathJax-Span-42" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-43" style="font-family: MathJax_Main;">12</span><span class="mo" id="MathJax-Span-44" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>H</mi><mn>5</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy="false">(</mo><mi>H</mi><mn>11</mn><mo>∥</mo><mi>H</mi><mn>12</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">H5 = SHA1(H11 \parallel H12)</script>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>H</mi><mn>2</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy=&quot;false&quot;>(</mo><mi>H</mi><mn>5</mn><mo>&amp;#x2225;</mo><mi>H</mi><mn>6</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-45" style="width: 12.457em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.038em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1009.95em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-46"><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-48" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main; padding-left: 0.271em;">=</span><span class="mi" id="MathJax-Span-50" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math-italic;">A</span><span class="mn" id="MathJax-Span-53" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-54" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-55" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-56" style="font-family: MathJax_Main;">5</span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main; padding-left: 0.271em;">∥</span><span class="mi" id="MathJax-Span-58" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-59" style="font-family: MathJax_Main;">6</span><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>H</mi><mn>2</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy="false">(</mo><mi>H</mi><mn>5</mn><mo>∥</mo><mi>H</mi><mn>6</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-5">H2 = SHA1(H5 \parallel H6)</script>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>H</mi><mn>0</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy=&quot;false&quot;>(</mo><mi>H</mi><mn>1</mn><mo>&amp;#x2225;</mo><mi>H</mi><mn>2</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-61" style="width: 12.457em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.038em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1009.95em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-64" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main; padding-left: 0.271em;">=</span><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-67" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math-italic;">A</span><span class="mn" id="MathJax-Span-69" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-71" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-72" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-73" style="font-family: MathJax_Main; padding-left: 0.271em;">∥</span><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Math-italic; padding-left: 0.271em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-75" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>H</mi><mn>0</mn><mo>=</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>1</mn><mo stretchy="false">(</mo><mi>H</mi><mn>1</mn><mo>∥</mo><mi>H</mi><mn>2</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">H0 = SHA1(H1 \parallel H2)</script></p>

<p>其中 <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2225;</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-77" style="width: 0.629em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.495em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.436em 1000.36em 2.735em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-78"><span class="mo" id="MathJax-Span-79" style="font-family: MathJax_Main;">∥</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo></mo></math></span></span><script type="math/tex" id="MathJax-Element-7">\parallel</script> 是表联接的意思.</p>

<p><img src="http://images.cnblogs.com/cnblogs_com/neoragex2002/temp/merkle.PNG" alt="Ref 3"></p>

<h3 id="应用举例">应用举例</h3>
<p><strong>BitTorrent中应用</strong>[3,7]</p>

<p>在BT中, 通常种子文件中包含的信息是Root值, 此外还有文件长度、数据块长等重要信息. 当客户端下载数据块8时，在下载前，它将要求peer提供校验块8所需的全部路径哈希值：H24、H12、H6和H1. 下载完成后, 客户端就会开始校验, 它先计算它已经下载的数据块8的Hash值23, 记做 <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>H</mi><msup><mn>23</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-variant&quot; mathvariant=&quot;normal&quot;>&amp;#x2032;</mi></mrow></msup></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-80" style="width: 2.69em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.153em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.391em 1002.15em 2.466em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-81"><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="msubsup" id="MathJax-Span-83"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.183em 1000.94em 4.124em -999.998em); top: -3.985em; left: 0em;"><span class="mn" id="MathJax-Span-84" style="font-family: MathJax_Main;">23</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.988em;"><span class="texatom" id="MathJax-Span-85"><span class="mrow" id="MathJax-Span-86"><span class="mi" id="MathJax-Span-87" style="font-size: 70.7%; font-family: MathJax_Main;">′</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><msup><mn>23</mn><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-variant" mathvariant="normal">′</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-8">H23^{\prime}</script> , 表示尚未验证. 随后会按照我在上一小节中给出的几个公式, 来依次求解 直到得到<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>H</mi><msup><mn>0</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-variant&quot; mathvariant=&quot;normal&quot;>&amp;#x2032;</mi></mrow></msup></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-88" style="width: 2.063em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.66em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.391em 1001.66em 2.466em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-89"><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="msubsup" id="MathJax-Span-91"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.183em 1000.45em 4.124em -999.998em); top: -3.985em; left: 0em;"><span class="mn" id="MathJax-Span-92" style="font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.495em;"><span class="texatom" id="MathJax-Span-93"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-size: 70.7%; font-family: MathJax_Main;">′</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><msup><mn>0</mn><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-variant" mathvariant="normal">′</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-9">H0^{\prime}</script> 并与<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>H</mi><mn>0</mn></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-96" style="width: 1.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.526em 1001.35em 2.466em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mn" id="MathJax-Span-99" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-10">H0</script>做比较, 校验通过则下载无误.
校验通过的这些路径哈希值会被缓存下来, 当一定数量的路径哈希值被缓存之后，后继数据块的校验过程将被极大简化。此时我们可以直接利用校验路径上层次最低的已知路径哈希值来对数据块进行部分校验，而无需每次都校验至根哈希值H0.</p>

<p><strong>Amazon Dynamo中同步</strong>[4]</p>

<p>在Dynamo中，每个节点保存一个范围内的key值，不同节点间存在有相互交迭的key值范围。在去熵操作中，考虑的仅仅是某两个节点间共有的key值范围。MT的叶子节点即是这个共有的key值范围内每个key的hash，通过叶子节点的hash自底向上便可以构建出一颗MT。Dynamo首先比对MT根处的hash，如果一致则表示两者完全一致，否则将其子节点交换并继续比较的过程, 知道定位到有差异的数据块. 这种同步方式在分布式中有着节省网络传输量的优点.</p>

<p><strong>Top-k Query RZhang Infocom2012</strong></p>

<p>在Rui Zhang的这篇文章[5]中, 作者采用MerkleTree的目的也在于校验POI信息的真实性
这篇文章的阅读笔记在[6]. 基本思想是假设我们需要得到的query是POI(point-of-interest, 相当于评价 reviews), <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mi>O</mi><msub><mi>I</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-100" style="width: 3.407em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.735em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.481em 1002.74em 2.78em -999.998em); top: -2.328em; left: 0em;"><span class="mrow" id="MathJax-Span-101"><span class="mi" id="MathJax-Span-102" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.092em;"></span></span><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math-italic;">O</span><span class="msubsup" id="MathJax-Span-104"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.183em 1000.5em 4.124em -999.998em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math-italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.851em; left: 0.45em;"><span class="texatom" id="MathJax-Span-106"><span class="mrow" id="MathJax-Span-107"><span class="mi" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-110" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.332em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.442em; border-left: 0px solid; width: 0px; height: 1.336em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mi>O</mi><msub><mi>I</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">POI_{i,j}</script>,其中 i 指区域, j指按TOP排序的POI条数. 文中数据收集者将不同区域的POIs的数据的摘要当作MerkleTree的叶子节点来建立一个BinaryTree. 这些信息一并提供给LBSP(街旁 Foursquare Google Lattitude这样的location based service Provider)在QueryResult中附带这些信息, 这样用户就可以根据这些信息来验证这个Top-k query的可信度, 以防止LBSP依据自己的利益需求来修改排名.</p>

<p><strong>Pasture</strong>[8]</p>

<p>在这篇文章中, 不同时刻的log使用了类似于路径哈希的方式, 每次更新在TPM的PCR中, 这些信息为文章实现离线的数据读取验证或者撤销提供了证据.</p>


<h3 id="reference">Reference</h3>

<ol>
  <li>http://en.wikipedia.org/wiki/Hash_tree</li>
  <li>http://en.wikipedia.org/wiki/Lamport_signature</li>
  <li>http://blog.csdn.net/starxu85/article/details/3859011</li>
  <li>http://ultimatearchitecture.net/index.php/2010/09/12/merkle-tree/</li>
  <li>http://www.public.asu.edu/~rzhang46/</li>
  <li>http://yishanhe.net/wiki/Secure-topk-query.html</li>
  <li>http://www.bittorrent.org/beps/bep_0030.html</li>
  <li>https://www.usenix.org/conference/osdi12/secure-offline-data-access-using-commodity-trusted-hardware</li>
</ol>

<h3 id="后记">后记</h3>
<p>虽然我没有验证, 是不是git也使用了hash tree??
还有一点就是在一个微信技术讲座上, 提到了并没有使用MT, 而是按照Set分布, 是全量加载, 但是数据从2G到了200K, 这是个什么情况??</p>


</article>

<br>
<br>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'yish'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
    

	
</div>